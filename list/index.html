<div class="list">
    {{#with todo=todo todos=todos app=app back=back keychain=keychain isUnlocked=@isUnlocked(keychain, todo)}}
        <h1>
            {{#if back}}
                <a href="#" onclick::{{@setTodo(app, @hasPin(todo.pin) ? app.data.defaultTodo : back)}} class="back">
                    â–¸
                </a>

                <span class="cog">
                    <a href="#" onclick::{{@togglePin(app, todo)}} class="{{#if @hasPin(todo.pin)}}pinned{{/if}}">
                        â—‰
                    </a>

                    {{#if todo.has_password}}
                        {{#if isUnlocked}}
                            <a href="#" onclick::{{@togglePin(app, todo)}}>
                                ðŸ”’
                            </a>
                        {{else}}
                            <a href="#" onclick::{{@togglePin(app, todo)}}>
                                ðŸ”’
                            </a>
                        {{/if}}
                    {{else}}
                        <a href="#" onclick::{{@togglePin(app, todo)}}>
                            ðŸ”“
                        </a>
                    {{/if}}
                </span>
            {{else}}
                {{#if todo.cog}}
                    <a href="#" onclick::{{@setTodo(app, todo.cog)}} class="back settings-back">
                        âš™
                    </a>
                {{/if}}
            {{/if}}

            <input type="text" disabled::{{!todo.id}} value::{{todo.title}} onblur::{{@set(app, 'title', undefined, todo)}}>
        </h1>

        <ul class="todos">
            {{#each @findTodos(todo, todos)}}
                <li data-id="{{id}}" class="{{@hasPin(pin) ? 'pinned' : ''}}">
                    <a href="#" onclick::{{@setTodo(app, this)}} class="go">
                        â–¸
                    </a>

                    <a href="#" onclick::{{@deleteTodo(app, this)}} class="delete">
                        x
                    </a>

                    <input type="text" value::{{title}} onblur::{{@setTodoInfo(this, 'title')}}>
                </li>
            {{/each}}
        </ul>

        {{#if isAdding}}
            <ul class="new-item">
                <li>
                    <form onsubmit::{{@add(app, list, todo)}}>
                        <input type="text" value::{{newTodo.title}} oninput::{{@set(list, 'newTodo.title')}} onblur::{{@add(app, list, todo, 1)}}>
                    </form>
                </li>
            </ul>
        {{/if}}
    {{/with}}
</div>

<div class="list-underlay" onclick::{{@addItem(list)}}></div>
